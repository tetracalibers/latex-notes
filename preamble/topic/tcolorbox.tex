% === tcolorbox ===

\usepackage{tcolorbox}
\tcbuselibrary{listings,breakable,xparse,skins,hooks,theorems,raster}

\newcommand{\titlegap}{\quad\\[0.1cm]}

\DeclareTColorBox{definition}{m O{} }%
{
  enhanced,
  colframe=magnolia,
  colback=magnolia!20!white,
  coltitle=black,
  fonttitle=\bfseries,
  breakable,
  sharp corners,
  title={\textcolor{Cerulean!60!black}{\faGraduationCap}\hspace{0.1em} #1},
  detach title,
  before upper={\tcbtitle\quad},
  bottom=0.5cm,
  top=0.5cm,
  right=0.5cm,
  left=0.5cm,
  #2
}

\DeclareTColorBox{theorem}{m O{} }%
{
  enhanced,
  colframe=magnolia,
  colback=magnolia!20!white,
  coltitle=black,
  fonttitle=\bfseries,
  breakable,
  sharp corners,
  title={\textcolor{magenta!70!black}{\faAnchor}\hspace{0.1em} #1},
  detach title,
  before upper={\tcbtitle\quad},
  bottom=0.5cm,
  top=0.5cm,
  right=0.5cm,
  left=0.5cm,
  #2
}

% 背景がグレー
\DeclareTColorBox{shaded}{O{} }%
{
  enhanced,
  colframe=white,
  colback=gray!10,
  breakable=true,
  sharp corners,
  detach title,
  bottom=0.25cm,
  top=0.25cm,
  right=0.25cm,
  left=0.25cm,
  #1
}

\DeclareTColorBox{emphabox}{O{CadetBlue}}{%
  enhanced,
  breakable,
  interior hidden,
  frame hidden,
  grow sidewards by=-5mm,
  beforeafter skip=\baselineskip,
  frame code={%
      \draw[line width=1pt,#1] ($(frame.north west)!0.3!(frame.north east)$) -- (frame.north west) -- ($(frame.north west)!0.3!(frame.south west)$);
      \draw[line width=1pt,#1] ($(frame.south east)!0.3!(frame.south west)$) -- (frame.south east) -- ($(frame.south east)!0.3!(frame.north east)$);
      \draw[rosepink, fill=carnationpink, decorate, decoration={footprints,foot length=7pt,foot of=felis silvestris, foot angle=5, foot sep=2pt}] ($(frame.south east)!0.3!(frame.south west)$) -- (frame.south east);
    }
}

\DeclareTColorBox{spacebox}{}{%
  enhanced,
  breakable,
  interior hidden,
  frame hidden,
  beforeafter skip=\baselineskip,
}

\newcommand{\ProofColor}{coolgrey}
\DeclareTColorBox{proof}{O{証明}}{%
  empty,
  title={\faBroom #1},
  attach boxed title to top left,
  sharp corners,
  boxed title style={
      empty,
      size=minimal,
      toprule=2pt,
      top=4pt,
      left=1em,
      right=1em,
      top=0.25cm,
      overlay={
          \draw[\ProofColor, double,line width=1pt] ([yshift=-1pt]frame.north west)--([yshift=-1pt]frame.north east);
        }
    },
  coltitle=\ProofColor,
  fonttitle=\bfseries,
  before=\par\medskip\noindent,
  parbox=false,
  boxsep=0pt,
  left=1em,
  right=1em,
  top=0.5cm,
  bottom=0.5cm,
  breakable,
  pad at break*=0mm,
  vfill before first,
  overlay unbroken={
      \draw[\ProofColor,line width=0.5pt]
      ([yshift=-1pt]title.north east)
      --([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)
      --([xshift=-0.5pt]frame.south east)
      --(frame.south west);
    },
  overlay first={
      \draw[\ProofColor,line width=1pt]([yshift=-1pt]title.north east)--([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)--([xshift=-0.5pt]frame.south east);
    },
  overlay middle={
      \draw[\ProofColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east);
    },
  overlay last={
      \draw[\ProofColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east)--(frame.south west);
    },%
}
\NewDocumentCommand{\patterntitle}{m}{
  \tcbox[
    enhanced,
    empty,
    boxsep=0pt,
    left=0pt,right=0pt,
    bottom=2pt,
    fonttitle=\bfseries,
    borderline south={0.5pt}{0pt}{\ProofColor},
  ]{\textcolor{\ProofColor}{#1}}
}
\renewenvironment{quote}{%
  \list{}{%
    \leftmargin0.5cm   % this is the adjusting screw
    \rightmargin\leftmargin
  }
  \item\relax
}{\endlist}
\newenvironment{subpattern}[1]{
  \patterntitle{#1}
  \begin{quote}
    }{
  \end{quote}
}

\newcommand{\HandoutColor}{uclablue!80}
\DeclareTColorBox{handout}{O{補足}}{%
  empty,
  title={\faCookieBite #1},
  attach boxed title to top left,
  sharp corners,
  boxed title style={
      empty,
      size=minimal,
      toprule=2pt,
      top=4pt,
      left=1em,
      right=1em,
      top=0.25cm,
      overlay={
          \draw[\HandoutColor, decorate,decoration=triangles,line width=1pt] ([yshift=-1pt]frame.north west)--([yshift=-1pt]frame.north east);
        }
    },
  coltitle=\HandoutColor,
  fonttitle=\bfseries,
  before=\par\medskip\noindent,
  parbox=false,
  boxsep=0pt,
  left=1em,
  right=1em,
  top=0.5cm,
  bottom=0.5cm,
  breakable,
  pad at break*=0mm,
  vfill before first,
  overlay unbroken={
      \draw[\HandoutColor,line width=0.5pt]
      ([yshift=-1pt]title.north east)
      --([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)
      --([xshift=-0.5pt]frame.south east)
      --(frame.south west);
    },
  overlay first={
      \draw[\HandoutColor,line width=1pt]([yshift=-1pt]title.north east)--([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)--([xshift=-0.5pt]frame.south east);
    },
  overlay middle={
      \draw[\HandoutColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east);
    },
  overlay last={
      \draw[\HandoutColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east)--(frame.south west);
    },%
}

\NewDocumentCommand{\fitLabelMath}{O{Rhodamine} O{Rhodamine!30} O{0.6} m m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    colback={#2},
    opacityback={#3},
    title={#5},
    coltitle={#1},
    fonttitle=\bfseries,
    left=1pt, right=1pt, top=1pt, bottom=1pt,
    attach boxed title to top center={yshift=-0.5mm},
    boxed title style={empty, top=0mm, bottom=0mm}
  ]{#4}
}

\NewDocumentCommand{\fitRectMath}{O{Rhodamine!30} m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    colback={#1},
    fonttitle=\bfseries,
    left=1pt, right=1pt, top=1pt, bottom=1pt,
    attach boxed title to top center={yshift=-0.5mm},
    boxed title style={empty, top=0mm, bottom=0mm},
    sharp corners,
  ]{#2}
}

\definecolor{reviewBgColor}{HTML}{F9F9F9}
\definecolor{reviewFgColor}{HTML}{6886C5}
\newtcolorbox{review}{
  colback=reviewBgColor,
  colbacktitle=reviewFgColor,
  title=REVIEW,
  enhanced,
  attach boxed title to top left={yshift=-0.18cm,xshift=-0.5mm},
  boxed title style={
      tikz={rotate=4,transform shape},
      frame code={
          \draw[decorate, reviewFgColor,decoration={random steps,segment length=2mm,amplitude=0.6pt},fill=lightgray!20] (frame.south west) rectangle (frame.north east);
        }
    },
  frame code={
      \draw[decorate, reviewFgColor!50,decoration={random steps,segment length=2mm,amplitude=0.6pt}] (frame.north east) rectangle (frame.south west);
    },
}

\NewDocumentCommand{\wavemath}{O{Rhodamine} m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    interior hidden,
    size=minimal,
    bottom=1.1em,
    overlay={
        \draw[
          #1,
          thick,
          decorate,
          decoration={
              snake,               % 波線を引く
              amplitude=0.1em,     % 波線の振幅
              segment length=0.5em   % 波線の周期
            }
        ] ([yshift=0.7em]frame.south west) -- ([yshift=0.7em]frame.south east);
      }
  ]{#2}
}

\NewDocumentCommand{\wavelabelmath}{O{Rhodamine} m m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    interior hidden,
    size=minimal,
    bottom=1.4em,
    overlay={
        \draw[
          #1,
          thick,
          decorate,
          decoration={
              snake,               % 波線を引く
              amplitude=0.1em,     % 波線の振幅
              segment length=0.5em   % 波線の周期
            }
        ] ([yshift=1.1em]frame.south west) -- ([yshift=1.1em]frame.south east)
        node[midway,below] {\bfseries #3};
      }
  ]{#2}
}
