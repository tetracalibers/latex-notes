\documentclass[../../../topic_linear-algebra]{subfiles}

\begin{document}

\sectionline
\section{行列の積}

\begin{theorem}{線形写像の合成}
  $\mathbb{R}^n$から$\mathbb{R}^m$への線形写像$g$と、$\mathbb{R}^m$から$\mathbb{R}^l$への線形写像$f$が与えられているとき、これらを合成して得られる写像
  \begin{equation*}
    f \circ g\colon \mathbb{R}^n \xrightarrow{g} \mathbb{R}^m \xrightarrow{f} \mathbb{R}^l
  \end{equation*}
  は、$\mathbb{R}^n$から$\mathbb{R}^l$への線形写像である
\end{theorem}

\begin{proof}
  \todo{\refbookA p56 （問2.2）}
\end{proof}

$f$と$g$の表現行列をそれぞれ$A = (a_{ij}), \, B = (b_{ij})$とする

$A$は$l \times m$型、$B$は$m \times n$型の行列である

\br

このとき、$f \circ g$は$l \times n$型行列で表現される

それを$C$と書くことにして、その成分を計算しよう

そのためには、基本ベクトルの写り先を見ればよい

\br

$B$を列ベクトルに分解して$B = (\vb*{b}_1, \vb*{b}_2, \dots, \vb*{b}_n)$と書くとき、
\begin{equation*}
  (f \circ g)(\vb*{e}_j) = f(g(\vb*{e}_j)) = f(\vb*{b}_j) = A \vb*{b}_j \quad (1 \leq j \leq n)
\end{equation*}
なので、
\begin{equation*}
  C = (A\vb*{b}_1, A\vb*{b}_2, \dots, A\vb*{b}_n)
\end{equation*}
となる

$C$の$(i, j)$成分は$A\vb*{b}_j$の第$i$成分なので、
\begin{equation*}
  c_{ij} = a_{i1} b_{1j} + a_{i2} b_{2j} + \cdots + a_{im} b_{mj} = \sum_{k=1}^m a_{ik} b_{kj}
\end{equation*}
により与えられる

つまり、$C$の$(i, j)$成分を計算するときは、$A$の第$i$行、$B$の第$j$列だけを見ればよい

\tikzset{highlight/.style={rectangle,
      fill=CarnationPink!30,
      rounded corners,
      fit=#1}}
\begin{equation*}
  \begin{NiceArray}{*{6}{c}@{\hspace{6mm}}*{5}{c}}[nullify-dots]
    \CodeBefore [create-cell-nodes]
    \SubMatrix({2-7}{6-last})
    \SubMatrix({7-2}{last-6})
    \SubMatrix({7-7}{last-last})
    \begin{tikzpicture}
      \node [highlight = (9-2) (9-6), inner sep=4pt] { } ;
      \node [highlight = (2-9) (6-9), inner sep=3pt] { } ;
      \node [highlight = (9-9), shape=circle, inner sep=2pt, fill=Rhodamine!35] {} ;
    \end{tikzpicture}
    \Body
     &        &        &        &        &        &        &        & j\text{\bfseries 列}                   \\
     &        &        &        &        &        & b_{11} & \Cdots & b_{1j}              & \Cdots & b_{1n} \\
     &        &        &        &        &        & \Vdots &        & \Vdots              &        & \Vdots \\
     &        &        &        &        &        &        &        & b_{kj}                                \\
     &        &        &        &        &        &        &        & \Vdots                                \\
     &        &        &        &        &        & b_{n1} & \Cdots & b_{mj}              & \Cdots & b_{mn} \\[3mm]
     & a_{11} & \Cdots &        &        & a_{1m}                                                           \\
     & \Vdots &        &        &        & \Vdots &        &        & \Vdots                                \\
    i\text{\bfseries 行}
     & a_{i1} & \Cdots & a_{ik} & \Cdots & a_{im} & \Cdots &        & c_{ij}                                \\
     & \Vdots &        &        &        & \Vdots                                                           \\
     & a_{n1} & \Cdots &        &        & a_{nm}                                                           \\
    \CodeAfter
    \tikz \draw[CarnationPink, thick, <->, shorten >=0.5em, shorten <=0.5em](9-4.north) to[bend left] (4-9.west);
    \tikz \path [decoration={text along path, text={{$\displaystyle\sum_{k=1}^m a_{ik} b_{kj}$}{}}, text color=Rhodamine, text align=center, raise=4ex}, decorate](9-4.north) to [bend left] (4-9.west);
  \end{NiceArray}
\end{equation*}

\br

このようにして得られた$l \times n$型行列$C$を$AB$と書き、$A$と$B$の\keyword{積}と呼ぶ

\sectionline

\begin{theorem}{単位行列との積}
  $A$を$m \times n$型とするとき、次が成り立つ
  \begin{align*}
    E_mA & = A \\
    AE_n & = A
  \end{align*}
\end{theorem}

\begin{theorem}{零行列との積}
  $A$を$m \times n$型とするとき、次が成り立つ
  \begin{equation*}
    O_m A = A O_n = O_{m,n}
  \end{equation*}
\end{theorem}

\sectionline

2つの行列の積が順番に依らない場合、2つの行列は\keyword{可換}であるという

\br

一般には、2つの行列は可換であるとは限らない

つまり、$AB$と$BA$は一般には異なる

\br

\todo{\refbookA p58 （例2.2.3, 2.2.4）}

\sectionline
\section{行列の和とスカラー倍}

$A, \, B$がともに$m \times n$型行列であるとき、それぞれの$(i, j)$成分を足すことで行列の和$A + B$を定める

\begin{theorem}{分配法則}
  積が定義できるとき、
  \begin{align*}
    A(B + C) & = AB + AC \\
    (B + C)A & = BA + CA
  \end{align*}
\end{theorem}

\begin{theorem}{行列の積とスカラー倍の性質}
  行列$A,\,B$の積$AB$が定義できるとき、つまり$A$の列の個数と$B$の行の個数が同じであるとき、$c \in \mathbb{R}$に対して
  \begin{equation*}
    (cA)B = A(cB) = c(AB)
  \end{equation*}
  が成り立つ
\end{theorem}

\sectionline

\begin{theorem}{線形写像の和}
  $f,g\colon \mathbb{R}^n \to \mathbb{R}^m$を線形写像とし、
  \begin{equation*}
    h(\vb*{v}) = f(\vb*{v}) + g(\vb*{v}) \quad (\vb*{v} \in \mathbb{R}^n)
  \end{equation*}
  により写像$h\colon \mathbb{R}^n \to \mathbb{R}^m$を定めるとき、$h$も線形写像である

  また、$f,g$の表現行列を$A,B$とするとき、$h$の表現行列は$A + B$である

  なお、$h = f + g$と書き、$f,g$の\keyword{和}と呼ぶ
\end{theorem}

\begin{proof}
  \todo{\refbookA p59 （問2.5）}
\end{proof}

\sectionline

\begin{definition}{スカラー行列}
  $c$をスカラーとするとき、$cE$の形の行列を\keyword{スカラー行列}という
  \begin{equation*}
    cE = \begin{pmatrix}
      c      & 0      & \cdots & 0      \\
      0      & c      & \cdots & 0      \\
      \vdots & \vdots & \ddots & \vdots \\
      0      & 0      & \cdots & c
    \end{pmatrix}
  \end{equation*}
\end{definition}

行列$A$にスカラー行列をかけることは、
\begin{equation*}
  (cE)A = A(cE) = cA
\end{equation*}
のように、スカラー$c$をかけるのと同じである

\sectionline
\section{行列の積の結合法則}

\begin{theorem}{積の結合法則}
  積$AB, \, BC$がともに定義できるとき、
  \begin{equation*}
    (AB)C = A(BC)
  \end{equation*}
\end{theorem}

\begin{proof}[写像による証明]
  $A,\,B, \, C$がそれぞれ$q \times m, \, m \times n, \, n \times p$型行列だとする

  線形写像の合成
  \begin{equation*}
    \mathbb{R}^p \xrightarrow{h} \mathbb{R}^n \xrightarrow{g} \mathbb{R}^m \xrightarrow{f} \mathbb{R}^q
  \end{equation*}
  を考え、$f,\, g, \, h$の表現行列をそれぞれ$A, \, B, \, C$とする

  一般的な写像の合成の性質として、
  \begin{equation*}
    (f \circ g) \circ h = f \circ (g \circ h)
  \end{equation*}
  が成り立つから、
  \begin{equation*}
    (AB)C = A(BC)
  \end{equation*}
  がしたがう $\qed$
\end{proof}

\begin{proof}[積の計算規則による証明]
  $AB$の$(i,l)$成分は、
  \begin{equation*}
    (AB)_{il} = \sum_{k=1}^m a_{ik} b_{kl}
  \end{equation*}
  これを用いて、
  \begin{align*}
    ((AB)C)_{ij} & = \sum_{l=1}^n (AB)_{il} c_{lj}                                 \\
                 & = \sum_{l=1}^n \left( \sum_{k=1}^m a_{ik} b_{kl} \right) c_{lj}
  \end{align*}

  $i,\,j$はいま固定されているので、和には関係がない

  動いているのは$k,\,l$だけ

  \br

  ここで、次の書き換えができる
  \begin{align*}
    \sum_{l=1}^n \left( \sum_{k=1}^m a_{ik} b_{kl} \right) c_{lj} & = \sum_{l=1}^n \left(\sum_{k=1}^m a_{ik} b_{kl} c_{lj} \right) \\
                                                                  & = \sum_{l=1}^n \sum_{k=1}^m a_{ik} b_{kl} c_{lj}
  \end{align*}
  $\displaystyle\sum_{l=1}^n$の右にある式は$l$に関する和をとる前のものなので、$l$は止まっていると考えてよく、単純な分配法則を使っている

  また、括弧がなくても、$k$に関する和を先にとって、その後で$l$に関する和をとっていると読むことができる

  \br

  このとき、和の順番は交換してもよいので、
  \begin{align*}
    \sum_{l=1}^n \sum_{k=1}^m a_{ik} b_{kl} c_{lj} & = \sum_{k=1}^m \sum_{l=1}^n a_{ik} b_{kl} c_{lj}                \\
                                                   & = \sum_{k=1}^m a_{ik} \left( \sum_{l=1}^n b_{kl} c_{lj} \right) \\
                                                   & = \sum_{k=1}^m a_{ik} (BC)_{kj}
  \end{align*}
  先ほどと同様に、$\displaystyle\sum_{k=1}^m$の右では$k$は止まっていると考えている

  そして、この結果は、$A(BC)$の$(i, j)$である $\qed$
\end{proof}

結合法則が成り立つことが示されたので、$(AB)C$または$A(BC)$を表すとき、括弧を書かずに単に$ABC$と書いても問題ない

行列の個数が増えても同様である

\br

また、$A$が正方行列の場合は、
\begin{align*}
  A^2 & = AA  \\
  A^3 & = AAA
\end{align*}
などのように書く

\sectionline
\section{行列の区分け}
\marginnote{\refbookA p64}

行列を
\begin{equation*}
  A = \begin{pmatrix}
    A_{11} & A_{12} \\
    A_{21} & A_{22}
  \end{pmatrix}
\end{equation*}
のようなブロック型に区分けして計算することがよくある

\br

$A$が$m \times n$型のとき、$m = m_1 + m_2, \, n = n_1 + n_2$として、$A_{ij}$は$m_i \times n_j$型である

\br

また、$B$が$n \times l$型で、$n = n_1 + n_2, \, l = l_1 + l_2$と区分けして
\begin{equation*}
  B = \begin{pmatrix}
    B_{11} & B_{12} \\
    B_{21} & B_{22}
  \end{pmatrix}
\end{equation*}
とするとき、
\begin{align*}
  AB & = \begin{pmatrix}
           A_{11} & A_{12} \\
           A_{21} & A_{22}
         \end{pmatrix} \begin{pmatrix}
                         B_{11} & B_{12} \\
                         B_{21} & B_{22}
                       \end{pmatrix}                             \\
     & = \begin{pmatrix}
           A_{11}B_{11} + A_{12}B_{21} & A_{11}B_{12} + A_{12}B_{22} \\
           A_{21}B_{11} + A_{22}B_{21} & A_{21}B_{12} + A_{22}B_{22}
         \end{pmatrix}
\end{align*}
のように$A_{ij}$などが行列の成分であるかのようにして（ただし積の順序は変えずに）積が計算できる

ここで、$A$の列の区分けと$B$の行の区分けの仕方が同じであることが必要である

\br

3つ以上のブロックに分ける場合も同様である

\end{document}
