% === color ===

% ref: https://latexcolor.com/
\definecolor{hotpink}{rgb}{1.0, 0.41, 0.71}
\definecolor{carnationpink}{rgb}{1.0, 0.65, 0.79}
\definecolor{deeppink}{rgb}{1.0, 0.08, 0.58}
\definecolor{capri}{rgb}{0.0, 0.75, 1.0}
\definecolor{rosepink}{rgb}{1.0, 0.4, 0.8}
\definecolor{princetonorange}{rgb}{1.0, 0.56, 0.0}
\definecolor{lavendermagenta}{rgb}{0.93, 0.51, 0.93}
\definecolor{malachite}{rgb}{0.04, 0.85, 0.32}
\definecolor{lawngreen}{rgb}{0.49, 0.99, 0.0}
\definecolor{periwinkle}{rgb}{0.8, 0.8, 1.0}
\definecolor{lightslategray}{rgb}{0.47, 0.53, 0.6}
\definecolor{robineggblue}{rgb}{0.0, 0.8, 0.8}
\definecolor{rosebonbon}{rgb}{0.98, 0.26, 0.62}
\definecolor{airforceblue}{rgb}{0.36, 0.54, 0.66}
\definecolor{columbiablue}{rgb}{0.61, 0.87, 1.0}
\definecolor{magnolia}{rgb}{0.97, 0.96, 1.0}
\definecolor{coolgrey}{rgb}{0.55, 0.57, 0.67}

% === box ===

\usepackage{awesomebox}

\newenvironment{supplnote}{
  \begin{awesomeblock}{1pt}{\faPaw}{lightgray}
    \small
    }{
  \end{awesomeblock}
}

% === math ===

\usepackage{physics}
\usepackage{braket}

\usepackage{amssymb} % use \blacksquare

\usepackage{amsthm} % 定理環境とQEDコマンド
\renewcommand{\qedsymbol}{\textcolor{coolgrey}{$\blacksquare$}}

\usepackage{mathtools}
% 別の場所で参照する数式以外は番号が付かないように
\mathtoolsset{showonlyrefs=true}

\usepackage{systeme} % 連立方程式を簡単に書く
\usepackage{empheq}

\newcommand{\id}{\operatorname{id}}
\newcommand{\Id}{\operatorname{Id}}
\newcommand{\diag}{\operatorname{diag}}
\newcommand{\Ker}{\operatorname{Ker}}
\newcommand{\sgn}{\operatorname{sgn}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\End}{\operatorname{End}}
\newcommand{\Span}{\operatorname{span}}

\newcommand{\suchthat}{\,\, s.t. \,\,}
\newcommand{\transpose}[1]{{}^t\! #1}

% === font ===

\usepackage{amsfonts} % use \mathbb
\usepackage{mathrsfs} % use \mathscr

\usepackage[T1]{fontenc}
\usepackage{lxfonts}

% monospace font
\renewcommand*\ttdefault{cmvtt}

% === layout ===

\usepackage[top=20truemm,bottom=20truemm,left=20truemm,right=60truemm,marginparwidth=40truemm,marginparsep=10truemm]{geometry} % 余白
\renewcommand{\baselinestretch}{1.25} % 行間

\usepackage{leading}

\setlength{\parindent}{0pt} % 段落始めでの字下げをしない

\usepackage{enumitem}
\newcommand{\romanlabel}{\textsf{\roman*.}}
\newcommand{\romannum}[1]{\textsf{#1}}

\usepackage[noparboxrestore]{marginnote}

\usepackage{tocloft}
% chapterのnumwidthを広くする
\setlength{\cftchapnumwidth}{5em}

\usepackage{titling}
\renewcommand{\maketitlehooka}{\textsf}

% === figure ===

\usepackage{here} % figure環境のHオプション（画像を強制的にその場に表示する）を提供
\usepackage{caption}

% figure環境内で図の\captionを、table環境内で表の\captionを使う
% ref: http://tony.in.coocan.jp/latex/index.html#captype
\makeatletter%% プリアンブルで定義する場合は必須
\newcommand{\figcap}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcap}[1]{\def\@captype{table}\caption{#1}}
\newcommand{\figcapstar}[1]{\def\@captype{figure}\caption*{#1}}
\newcommand{\tblcapstar}[1]{\def\@captype{table}\caption*{#1}}
\makeatother%% プリアンブルで定義する場合は必須

% === tikz ===

\usepackage[dvipdfmx]{graphicx}

\usepackage{tikz}
\usetikzlibrary{
  fit,
  patterns,
  patterns.meta,
  decorations.text,
  decorations.pathreplacing,
  decorations.footprints,
  cd,
  petri,
  positioning,
  calc,
  angles,
  arrows.meta,
  shapes.multipart,
  shapes.geometric,
  backgrounds,
  3d,
  quotes
}

\usepackage{tikz-3dplot}

\tikzstyle{axis}=[->, >=Stealth]
\tikzstyle{vector}=[->,>=Stealth,very thick, line cap=round]

\usepackage{ifthen}
\usepackage{listofitems} % for \readlist to create arrays

\usepackage{witharrows}
\usepackage{nicematrix}

% === tcolorbox ===

\usepackage{tcolorbox}
\tcbuselibrary{listings,breakable,xparse,skins,hooks,theorems,raster}

\newcommand{\titlegap}{\quad\\[0.1cm]}

\DeclareTColorBox{definition}{m O{} }%
{
  enhanced,
  colframe=magnolia,
  colback=magnolia!20!white,
  coltitle=black,
  fonttitle=\bfseries,
  breakable,
  sharp corners,
  title={\textcolor{Cerulean!60!black}{\faGraduationCap}\hspace{0.1em} #1},
  detach title,
  before upper={\tcbtitle\quad},
  bottom=0.5cm,
  top=0.5cm,
  right=0.5cm,
  left=0.5cm,
  #2
}

\DeclareTColorBox{theorem}{m O{} }%
{
  enhanced,
  colframe=magnolia,
  colback=magnolia!20!white,
  coltitle=black,
  fonttitle=\bfseries,
  breakable,
  sharp corners,
  title={\textcolor{magenta!70!black}{\faAnchor}\hspace{0.1em} #1},
  detach title,
  before upper={\tcbtitle\quad},
  bottom=0.5cm,
  top=0.5cm,
  right=0.5cm,
  left=0.5cm,
  #2
}

% 背景がグレー
\DeclareTColorBox{shaded}{O{} }%
{
  enhanced,
  colframe=white,
  colback=gray!10,
  breakable=true,
  sharp corners,
  detach title,
  bottom=0.25cm,
  top=0.25cm,
  right=0.25cm,
  left=0.25cm,
  #1
}

\DeclareTColorBox{emphabox}{O{CadetBlue}}{%
  enhanced,
  breakable,
  interior hidden,
  frame hidden,
  grow sidewards by=-5mm,
  beforeafter skip=\baselineskip,
  frame code={%
      \draw[line width=1pt,#1] ($(frame.north west)!0.3!(frame.north east)$) -- (frame.north west) -- ($(frame.north west)!0.3!(frame.south west)$);
      \draw[line width=1pt,#1] ($(frame.south east)!0.3!(frame.south west)$) -- (frame.south east) -- ($(frame.south east)!0.3!(frame.north east)$);
      \draw[rosepink, fill=carnationpink, decorate, decoration={footprints,foot length=7pt,foot of=felis silvestris, foot angle=5, foot sep=2pt}] ($(frame.south east)!0.3!(frame.south west)$) -- (frame.south east);
    }
}

\DeclareTColorBox{spacebox}{}{%
  enhanced,
  breakable,
  interior hidden,
  frame hidden,
  beforeafter skip=\baselineskip,
}

\newcommand{\ProofColor}{coolgrey}
\DeclareTColorBox{proof}{O{証明}}{%
  empty,
  title={\faBroom #1},
  attach boxed title to top left,
  sharp corners,
  boxed title style={
      empty,
      size=minimal,
      toprule=2pt,
      top=4pt,
      left=1em,
      right=1em,
      top=0.25cm,
      overlay={
          \draw[\ProofColor, double,line width=1pt] ([yshift=-1pt]frame.north west)--([yshift=-1pt]frame.north east);
        }
    },
  coltitle=\ProofColor,
  fonttitle=\bfseries,
  before=\par\medskip\noindent,
  parbox=false,
  boxsep=0pt,
  left=1em,
  right=1em,
  top=0.5cm,
  bottom=0.5cm,
  breakable,
  pad at break*=0mm,
  vfill before first,
  overlay unbroken={
      \draw[\ProofColor,line width=0.5pt]
      ([yshift=-1pt]title.north east)
      --([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)
      --([xshift=-0.5pt]frame.south east)
      --(frame.south west);
    },
  overlay first={
      \draw[\ProofColor,line width=1pt]([yshift=-1pt]title.north east)--([xshift=-0.5pt,yshift=-1pt]title.north-|frame.east)--([xshift=-0.5pt]frame.south east);
    },
  overlay middle={
      \draw[\ProofColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east);
    },
  overlay last={
      \draw[\ProofColor,line width=1pt] ([xshift=-0.5pt]frame.north east)--([xshift=-0.5pt]frame.south east)--(frame.south west);
    },%
}
\NewDocumentCommand{\patterntitle}{m}{
  \tcbox[
    enhanced,
    empty,
    boxsep=0pt,
    left=0pt,right=0pt,
    bottom=2pt,
    fonttitle=\bfseries,
    borderline south={0.5pt}{0pt}{\ProofColor},
  ]{\textcolor{\ProofColor}{#1}}
}
\renewenvironment{quote}{%
  \list{}{%
    \leftmargin0.5cm   % this is the adjusting screw
    \rightmargin\leftmargin
  }
  \item\relax
}{\endlist}
\newenvironment{subpattern}[1]{
  \patterntitle{#1}
  \begin{quote}
    }{
  \end{quote}
}

\NewDocumentCommand{\fitLabelMath}{O{Rhodamine} O{Rhodamine!30} O{0.6} m m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    colback={#2},
    opacityback={#3},
    title={#5},
    coltitle={#1},
    fonttitle=\bfseries,
    left=1pt, right=1pt, top=1pt, bottom=1pt,
    attach boxed title to top center={yshift=-0.5mm},
    boxed title style={empty, top=0mm, bottom=0mm}
  ]{#4}
}

\NewDocumentCommand{\fitRectMath}{O{Rhodamine!30} m}{
  \tcboxmath[
    enhanced,
    frame hidden,
    colback={#1},
    fonttitle=\bfseries,
    left=1pt, right=1pt, top=1pt, bottom=1pt,
    attach boxed title to top center={yshift=-0.5mm},
    boxed title style={empty, top=0mm, bottom=0mm},
    sharp corners,
  ]{#2}
}

% === memo ===

\usepackage{zebra-goodies} % TODOなどの注釈

% === original ===

\NewDocumentCommand{\keyword}{O{RubineRed} m}{\textcolor{#1}{\textbf{#2}}}
\newcommand{\en}[1]{\texttt{\small #1}}
\newcommand{\keywordJE}[2]{\keyword{#1}（\textcolor{RubineRed!60}{\texttt{\small #2}}）}

\newcommand{\br}{\vskip0.5\baselineskip}

\usepackage[object=vectorian]{pgfornament}
\newcommand{\sectionline}{%
  \noindent
  \begin{center}
    {\color{lightgray}
      \resizebox{0.5\linewidth}{1ex}
      {{%
            {\begin{tikzpicture}
                  \node  (C) at (0,0) {};
                  \node (D) at (9,0) {};
                  \path (C) to [ornament=85] (D);
                \end{tikzpicture}}}}}%
  \end{center}%
}

\renewcommand{\labelitemii}{$\circ$}

\newcommand{\refbook}[1]{\small ref: #1}

% === toc ===

\usepackage{tocloft}
\renewcommand{\cftsecfont}{\rmfamily}
\renewcommand{\cftsecpagefont}{\rmfamily}
\setcounter{secnumdepth}{0}

\addtocontents{toc}{\protect\thispagestyle{empty}}
\pagestyle{empty}

% === hyperlink ===

\definecolor{oxfordblue}{rgb}{0.0, 0.13, 0.28}

% 「%」は以降の内容を「改行コードも含めて」無視するコマンド
\usepackage[%
  dvipdfmx,% 欧文ではコメントアウトする
  pdfencoding=auto, psdextra,% 数学記号を含める
  setpagesize=false,%
  bookmarks=true,%
  bookmarksdepth=tocdepth,%
  bookmarksnumbered=true,%
  colorlinks=true,%
  allcolors=oxfordblue,%
  linkcolor=MidnightBlue,%
  pdftitle={},%
  pdfsubject={},%
  pdfauthor={},%
  pdfkeywords={}%
]{hyperref}
% PDFのしおり機能の日本語文字化けを防ぐ((u)pLaTeXのときのみかく)
\usepackage{pxjahyper}
% ref: https://tex.stackexchange.com/questions/251491/math-symbol-in-section-heading
\pdfstringdefDisableCommands{\def\varepsilon{\textepsilon}}
